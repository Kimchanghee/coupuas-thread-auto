# 자동 업데이트 시스템 테스트 가이드

## 테스트 환경 준비

### 1. 로컬 빌드 테스트

```bash
# 의존성 설치
pip install -r requirements.txt

# Playwright 브라우저 설치
playwright install chromium

# 테스트 빌드
python build_exe.py
```

### 2. 빌드 결과 확인

- `dist/CoupangThreadAuto.exe` 파일 생성 확인
- 파일 크기가 적절한지 확인 (예상: 50-100MB)
- 실행 파일이 정상적으로 시작되는지 확인

## 자동 업데이트 기능 테스트

### 시나리오 1: 최신 버전 확인 (업데이트 없음)

**목적**: 현재 최신 버전을 사용 중일 때의 동작 확인

1. GitHub에 릴리즈가 없거나 현재 버전과 동일한 경우
2. 프로그램 실행
3. 3초 후 업데이트 체크 자동 실행
4. 알림이 나타나지 않아야 함
5. 수동으로 "업데이트" 버튼 클릭
6. "최신 버전을 사용 중입니다" 메시지 확인

**예상 결과**: ✅ 최신 버전 사용 중 메시지

### 시나리오 2: 새 버전 발견 및 다운로드

**목적**: 새 버전이 있을 때 업데이트 프로세스 확인

**준비**:
1. `main.py`에서 `VERSION = "v2.1.0"` (낮은 버전으로 설정)
2. 로컬 빌드 실행
3. GitHub에 `v2.2.0` 릴리즈가 있어야 함

**테스트**:
1. 빌드된 EXE 실행
2. 3초 후 자동으로 업데이트 알림 표시 확인
3. "예" 클릭하여 업데이트 다이얼로그 열기
4. 새 버전 정보 확인 (v2.2.0)
5. 변경사항 내용 확인
6. "다운로드 및 설치" 버튼 클릭
7. 진행률 표시 확인 (0% → 100%)
8. 다운로드 완료 확인
9. 설치 확인 대화상자에서 "예" 클릭
10. 프로그램 자동 종료 및 업데이트 스크립트 실행 확인

**예상 결과**:
- ✅ 다운로드 성공
- ✅ 업데이트 스크립트 실행
- ✅ 프로그램 자동 재시작
- ✅ 새 버전으로 실행됨 (v2.2.0)

### 시나리오 3: 업데이트 취소

**목적**: 사용자가 업데이트를 취소할 때의 동작 확인

1. 업데이트 알림에서 "아니오" 클릭
2. 프로그램 정상 계속 실행 확인
3. 또는 다운로드 후 설치 확인에서 "아니오" 클릭
4. 프로그램 정상 계속 실행 확인

**예상 결과**: ✅ 프로그램이 정상적으로 계속 실행됨

### 시나리오 4: 네트워크 오류

**목적**: 네트워크 문제 시 에러 처리 확인

1. 인터넷 연결 끊기
2. "업데이트" 버튼 클릭
3. 에러 메시지 확인
4. 프로그램이 크래시하지 않는지 확인

**예상 결과**: ✅ 에러 메시지 표시, 프로그램 정상 작동

### 시나리오 5: 개발 모드 테스트

**목적**: 개발 모드에서는 자동 설치가 안 되는 것 확인

1. `python main.py`로 직접 실행 (빌드 안 함)
2. "업데이트" 버튼 클릭
3. 다운로드까지는 성공
4. 설치 시도 시 경고 메시지 확인

**예상 결과**: ✅ "개발 모드에서는 자동 업데이트가 지원되지 않습니다" 메시지

## GitHub Actions 워크플로우 테스트

### 시나리오 6: 자동 빌드 및 릴리즈

**준비**:
1. `main.py`에서 `VERSION = "v2.3.0"` 업데이트
2. 변경사항 커밋

**테스트**:
```bash
# 태그 생성
git tag v2.3.0

# 태그 푸시
git push origin v2.3.0
```

**확인**:
1. GitHub → Actions 탭 이동
2. "Build and Release" 워크플로우 실행 확인
3. 각 단계별 로그 확인:
   - ✅ Checkout code
   - ✅ Set up Python
   - ✅ Install dependencies
   - ✅ Build executable
   - ✅ Verify build
   - ✅ Create Release
4. Releases 탭에서 새 릴리즈 확인
5. `CoupangThreadAuto.exe` 파일 다운로드 가능 확인

**예상 결과**: ✅ 자동으로 릴리즈 생성 및 EXE 업로드

### 시나리오 7: 수동 워크플로우 트리거

1. GitHub → Actions 탭
2. "Build and Release" 선택
3. "Run workflow" 클릭
4. 버전 입력 (예: v2.4.0)
5. 실행 확인

**예상 결과**: ✅ 수동으로 지정한 버전으로 빌드 및 릴리즈

## 통합 테스트

### 완전한 업데이트 사이클 테스트

1. **v2.1.0 빌드 및 배포**
   ```bash
   # main.py에서 VERSION = "v2.1.0"
   python build_exe.py
   git tag v2.1.0
   git push origin v2.1.0
   ```

2. **사용자 설치**
   - v2.1.0 EXE 다운로드 및 실행
   - 정상 작동 확인

3. **v2.2.0 릴리즈**
   ```bash
   # main.py에서 VERSION = "v2.2.0"
   git add .
   git commit -m "Release v2.2.0"
   git tag v2.2.0
   git push origin v2.2.0
   ```

4. **자동 업데이트 테스트**
   - v2.1.0 실행 중인 프로그램 재시작
   - 업데이트 알림 확인
   - 업데이트 진행
   - v2.2.0으로 성공적으로 업데이트 확인

**예상 결과**: ✅ 전체 업데이트 프로세스 완료

## 에지 케이스 테스트

### 케이스 1: 권한 부족

- 프로그램을 읽기 전용 폴더에 설치
- 업데이트 시도
- 권한 오류 처리 확인

**예상**: 권한 오류 메시지, 백업에서 복구

### 케이스 2: 디스크 공간 부족

- 다운로드 중 디스크가 가득 찬 경우 시뮬레이션
- 에러 메시지 확인
- 프로그램 안정성 확인

**예상**: 디스크 공간 부족 메시지, 프로그램 정상 작동

### 케이스 3: 다운로드 중단

- 다운로드 중 인터넷 연결 끊기
- 에러 처리 확인
- 재시도 가능한지 확인

**예상**: 다운로드 실패 메시지, 재시도 가능

### 케이스 4: 손상된 업데이트 파일

- 다운로드된 파일이 손상된 경우
- 설치 실패 시 백업 복구 확인

**예상**: 설치 실패, 백업에서 자동 복구

## 성능 테스트

### 다운로드 속도

- 50MB 파일 다운로드 시간 측정
- 진행률 업데이트 빈도 확인
- UI 응답성 확인 (다운로드 중에도 창이 멈추지 않음)

**목표**:
- 50MB 파일을 1-3분 내 다운로드
- 진행률이 매끄럽게 업데이트됨
- UI가 멈추지 않음

### 메모리 사용량

- 업데이트 프로세스 중 메모리 사용량 모니터링
- 메모리 누수 확인

**목표**: 메모리 사용량이 200MB 이하

## 체크리스트

릴리즈 전 필수 테스트:

- [ ] 로컬 빌드 성공
- [ ] EXE 파일 정상 실행
- [ ] 최신 버전 확인 동작
- [ ] 업데이트 다운로드 성공
- [ ] 업데이트 설치 및 재시작 성공
- [ ] 업데이트 취소 동작
- [ ] 네트워크 오류 처리
- [ ] GitHub Actions 자동 빌드 성공
- [ ] 릴리즈 자동 생성 확인
- [ ] 여러 버전 간 업데이트 테스트

## 문제 발생 시

### 빌드 실패

1. `build_exe.py` 로그 확인
2. 의존성 설치 확인: `pip install -r requirements.txt`
3. Playwright 브라우저 설치: `playwright install chromium`
4. Python 버전 확인: Python 3.8+

### 업데이트 실패

1. GitHub 저장소 설정 확인 (`src/auto_updater.py`)
2. 인터넷 연결 확인
3. GitHub Releases 페이지에서 파일 확인
4. 로그 메시지 확인

### GitHub Actions 실패

1. Actions 탭에서 로그 확인
2. 태그 형식 확인 (`v*.*.*`)
3. 권한 설정 확인 (`GITHUB_TOKEN`)
4. 워크플로우 파일 문법 확인

---

**버그 리포트**: 문제가 발생하면 GitHub Issues에 다음 정보를 포함하여 등록:
- Windows 버전
- 프로그램 버전
- 에러 메시지 전문
- 재현 단계
